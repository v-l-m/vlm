This file traces the changes that are required for upgrading from a previous VLM version
___
From 0.15.2 to 0.15.5

= NEPTUNE =

  RUN (for each <module>)
    ./maj_module.sh <module>
  
  EDIT crontab
    and deactivate clean-up and moteur

= S9 & S11 =

  EDIT
    conf/param.php
    and change database to be neptune

= S9 =

  RUN
    ./maj_module.sh base

  EDIT crontab
    deactivate vlm-cron-clean.sh
    
  RUN
    ./vlmcode/base/dump-history.sh /var/www/tmpdump/vlm-history.sql

= NEPTUNE =
  
  get the dump, and ./vlmcode/base/script/import.sh <it>

= S9 = (From here, you have to be quick !)

  EDIT crontab
    deactivate vlm-cron.sh

  RUN
    ./vlmcode/base/dump-alive.sh

= NEPTUNE =
  
  get the dump, and ./vlmcode/base/script/import.sh <it>

= DNS SERVER =
  point virtual-loup-de-mer.org on Neptune.

= S9 & S11 =

  RUN
    ./maj_module.sh lib/phpcommon

= NEPTUNE =
  
  reactivate engine (moteur & clean)
  
= S9 & S11 =
  make them slave for grib downloading

____  
From 0.14 to Next:

= All servers =

  EDIT file ./conf/conf_script 
    - change VLM SVNBRANCH to V_0_15
    - add VLMCACHE=~/cached (autre exemple : VLMCACHE=$VLMDATAS/cache
  CHECK file ./conf/conf_script : it should be setting $VLMGSHHS correctly, and this should be consistent with the GSHHS_DIRECTORY in your param.php file.
  EDIT file ./conf/param.php, and add (with correct path) following lines !
      define("TILES_G_PATH", "/home/commun/bin/tiles_g"); #tiles_g is moved in your $VLMBIN (read you conf_script file)

  RUN
    ./scripts/maj_scripts.sh

  Check if gd-dev (libgd-dev) is available for your distro and install it if it is not already.
      Debian: apt-get install libgd2-xpm-dev

  RUN
    ./scripts/maj_module.sh clip_gshhs
      (this could take some time because of maps bd downloading)

  RUN
    ./scripts/maj_module.sh guest_map

  RUN
    ./scripts/maj_module.sh jvlm


= Master Server =

  STOP VLM Engine (comment in the crontab)

  RUN
    ./scripts/maj_module.sh base
    cd ./vlmcode/base/scripts/
    ./runupgrade.sh 0.15 > log.txt
    cd 

  RUN
    ./scripts/maj_module.sh moteur

= All servers =

  RUN
    ./scripts/maj_module.sh lib/vlm-c
    (as root) /etc/init.d/apache2 restart (or service apache2 restart)

    ./scripts/maj_module.sh lib/phpcommon
    ./scripts/maj_module.sh site
    ./scripts/maj_module.sh medias

= Master Server =

  RESTART VLM Engine (uncomment in the crontab)


From 0.13 to Next:

= All servers =

  EDIT file ./conf/conf_script and change VLM SVNBRANCH to V_0_14

  RUN
    ./scripts/maj_scripts.sh
    
  RUN
    ./scripts/check_mail_config.sh your@adress.com
    
  CHECK
    ...your inbox ;)

  EDIT file ./conf/param.php
    and add correct values for keys :
      define("DBMAPSERVER", "127.0.0.1"); 
      define("DBMAPUSER", "vlm");
      define("DBMAPPASSWORD", "***");

  EDIT file ./conf/param.php
    and modify key values for :
      define("DBSLAVESERVER", "127.0.0.1"); 
      define("DBSLAVEUSER", "vlm");
      define("DBSLAVEPASSWORD", "***");
    to point to S9 (master server).
        (We keep master/slave paradigm for future uses)

  EDIT file ./conf/param.php
    and delete line defining "SYSTEME_WIND_AT_POSITION" (which is not used anymore since...)

= Master Server =

  RUN
    ./scripts/maj_module.sh base
    cd ./vlmcode/base/scripts/
    ./runupgrade.sh 0.14 > log.txt
    cd 

  RUN
    ./scripts/maj_module.sh moteur

  RUN
    source $VLMRACINE/conf/conf_script
    rm $VLMGSHHS/*.b
    ./scripts/maj_module.sh maps

= All servers =

  RUN
    ./scripts/maj_module.sh lib/vlm-c
    (as root) /etc/init.d/apache2 restart (or service apache2 restart)

    ./scripts/maj_module.sh lib/phpcommon
    ./scripts/maj_module.sh site
    ./scripts/maj_module.sh medias


From 0.12 to Next :

= All servers = 

  EDIT file ./conf/conf_script and change VLM SVNBRANCH to V_0_13

  RUN
    ./scripts/maj_scripts.sh

  EDIT file ./conf/param.php
    and add correct values for keys :
      define("VLM_PROXY_PASS", "PROXYPASS"); //Change the password to something else !!! This is needed for client passing IP infos to VLM

  ./scripts/maj_module.sh lib/vlm-c
  RESTART apache


= Master Server =

BASE
  ./scripts/maj_module.sh base
  cd ./vlmcode/base/scripts/
  ./runupgrade.sh 0.13
  cd 

MOTEUR
  ./scripts/maj_module.sh moteur


= All servers =

  ./scripts/maj_module.sh lib/phpcommon
  ./scripts/maj_module.sh site
  ./scripts/maj_module.sh medias
___
From 0.11 to Next

= All servers =

HOSTING
  EDIT file ./conf/conf_script and change VLM SVNBRANCH to V_0_12

  RUN
    ./scripts/maj_scripts.sh

  EDIT file ./conf/param.php
    and add correct values for keys :
      define("DBMASTERSERVER", "127.0.0.1");
      define("DBMASTERUSER", "vlm");
      define("DBMASTERPASSWORD", "***");
      define("DBSLAVESERVER", "127.0.0.1");
      define("DBSLAVEUSER", "vlm");
      define("DBSLAVEPASSWORD", "***");

    and del keys :
      define("DBSERVER", "localhost");
      define("DBUSER", "vlm");
      define("DBPASSWORD", "***");

= Master Server =

BASE
  ./scripts/maj_module.sh base
  cd ./vlmcode/base/scripts/
  ./runupgrade.sh 0.12
  cd 

MOTEUR
  ./scripts/maj_module.sh lib/phpcommon
  ./scripts/maj_module.sh moteur
  
  Add the new clean-up script in the crontab
      2-59/5 * * * *     $VLMRACINE/testing/moteur/cron-vlm-clean.sh

= All servers =

  ./scripts/maj_module.sh lib/phpcommon
  ./scripts/maj_module.sh site
  ./scripts/maj_module.sh medias

From 0.10.2 To Next

=On the main database server=

==Hosting==
* Do the ./scripts/maj_scripts.sh

==Base==
* Please, update the base module
  ./scripts/maj_module.sh base

* Then see the UPDATE FILE in the base module

=On all servers :=

==Configuration==
* EDIT conf/param.php and add :
  - define("WEBINSTANCE_COUNT", 3);
  - define("WEBINSTANCE_1", "s9.virtual-loup-de-mer.org" );
  - define("WEBINSTANCE_2", "s10.virtual-loup-de-mer.org" );
  - define("WEBINSTANCE_3", "s11.virtual-loup-de-mer.org" );

==And update all others modules==

From 0.9.7 To next...

=Base=
* see the UPDATE FILE in the base module

=Configuration=
* EDIT hosting/conf/conf_script
 - add "export VLMPOLARS=$VLMDATAS/gshhs"
* EDIT hosting/conf/param.php and add
 - "define("POLARS_DIRECTORY", "/same/as/VLMPOLARS");"
* NB: the directory will be created automatically

To 0.9.5 from 0.9
_______________
(Do it in this order, please)

=Configuration=
* EDIT hosting/conf/conf_script
 - change the branch to V_9_5
 - add "export VLMLOG=$VLMTEMP" (or something else...)
 - optionally, add "export VLM_GRIB_MAX=36" (or whatever you wish)

=Moteur=
* be careful, the location of the scripts for getting externals positions has changed
  
To 0.9 from 0.8
_______________

(Do it in this order, please)

=Configuration=
* EDIT hosting/conf/conf_script
 - change the branch to V_0_9 
 - add "export VLMDATAS=$VLMRACINE/vlmdatas"
 - add "export VlMGSHHS=$VLMDATAS/gshhs"
* EDIT hosting/conf/param.php and add
 - "define("GSHHS_DIRECTORY", "/same/as/VLMGSHHS");"

=Hosting=

Update the script directory :
~/scripts/maj_scripts.sh
 
=Database=
 
See file UPDATE in the module "base"

=Grib=

Please run the new 'windserver' binary ASAP in order to have a correct segment in memory.

=Maps=

You have to make deployment of module maps :
 $ ./maj_module.sh maps
 
This is going to download gshhs files during the first deployment.

=Moteur=

You can check now that all is OK

= Others=

Just deploy other modules again (site, lib/phpcommon, medias)
